<!DOCTYPE html>
<html lang="en">
<head>
    <title>MongoDB</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../ShowerTemplate/shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
</head>
<body class="shower list">

    <header class="caption">
        <h1>MongoDB</h1>
        <p>Mikel Egaña Aranguren</p>
    </header>

    <section class="slide" id="cover">
        <h2>MongoDB</h2>
        <p>Mikel Egaña Aranguren</p>
        <p><a href="https://mikel-egana-aranguren.github.io/">mikel-egana-aranguren.github.io</a></p>
        <p><a href="mailto:mikel.egana@ehu.eus">mikel.egana@ehu.eus</a></p>
        <img src="../ShowerTemplate/pictures/ehu.png" alt="UPV/EHU ingenieros San Mames" height="25%" style="border: 1px solid #555;">
    </section>

    <section class="slide">
        <h2>MongoDB</h2>
        <p><a href="https://github.com/mikel-egana-aranguren/ABD">https://github.com/mikel-egana-aranguren/ABD</a></p>
        <img src="../ShowerTemplate/pictures/by.png" alt="Creative Commons BY" height="10%">
    </section>

    <section class="slide">
        <h2>MongoDB</h2>
        <p><a href="https://www.mongodb.com/">https://www.mongodb.com/</a></p>
        <p>BD NoSQL orientada a documentos (JSON)</p>
        <p>Su nombre viene de la palabra Humongous (“gigantesco”)</p>
    </section>

    <section class="slide">
        <h2>MongoDB</h2>
        <ul>
            <li>MongoDB Community Edition: Versión libre</li>
            <li>MongoDB Enterprise: Versión comercial</li>
            <li>Atlas: Servicio en la nube</li>
            <li>Herramientas adicionales: P.e. Compass (GUI)</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Estructura de datos</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/modelo.svg" alt="Estructura MongoDB" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Estructura de datos</h2>
        <p>Un documento se organiza en formato <a href="https://datatracker.ietf.org/doc/html/rfc4627">JSON</a> (JavaScript Object Notation): Internamente se almacena en formato <a href="https://bsonspec.org/">Binary JSON</a> (BSON)</p>
        <p>Cada dato como clave valor</p>
        <p>Un valor puede ser otro documento</p>
        <p>Un valor puede tener varios documentos</p>
    </section>

    <section class="slide">
        <h2>JSON</h2>
        <pre>
            <code>
                {
                    nombre: "Mikel"
                    email: "mikel.egana@ehu.eus"
                    direccion: 
                    {
                        ciudad: "Bilbao"
                    }
                    telefonos: [
                        {
                            despacho: 946014786
                        },
                        {
                            movil: 666777888
                        }
                    ] 
                }
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2>Estructura de datos</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/json.png" alt="Estructura MongoDB - JSON" width="60%"></p>
    </section>

    <section class="slide">
        <h2>Estructura de datos</h2>
        <p>Equivalencia aproximada con modelo relacional:
            <ul>
                <li>Tabla - colección</li>
                <li>Fila - documento</li>
                <li>Columna - clave</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Estructura de datos</h2>
        <p>Diferencias principales con modelo relacional:
            <ul>
                <li>No todos los documentos tienen por qué tener las mismas claves</li>
                <li>No es necesario definir relaciones explícitas entre documentos</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Limpiar la pantalla: <pre>> cls</pre></li>
            <li>Mostrar BBDD existentes: <pre>> show dbs</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Mostrar BBDD en uso: <pre>> db</pre></li>
            <li>Cambiar a una BBDD: <pre>> use nombre-BBDD</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Creación de BBDD y colecciones</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/crear-bd.png" alt="Crear BD" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Creación de BBDD y colecciones</h2>
        <p>Cada documento tiene un identificador único (Se asigna automáticamente en su creación, aunque también podemos asignar uno de forma manual)</p>
        <p><img  src="pictures-abd-01/creado.png" alt="Creado" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Creación de BBDD y colecciones</h2>
        <p>Insertar múltiples documentos en una colección: <pre>> db.[nombre-colección].insertMany( [array-docs] )</pre></p>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Mostrar todos los documentos: <pre>> db.[nombre-colección].find()</pre></li>
            <li>Mostrar los documentos que encajen con un patrón: <pre>> db.[nombre-colección].find([patrón])</pre></li>
            <li>Encontrar el 1er documento que encaje con un patrón: <pre>> db.[nombre-colección].findOne([patrón])</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Buscar en la colección “clientes” los clientes con nombre “Unai”: <pre>> db.clientes.find( { nombre: "Unai" } )</pre></li>
            <li>Buscar en “clientes” los clientes con nombre “Unai” y DNI 12345: <pre>> db.clientes.find( { nombre: "Unai", DNI: 12345 } )</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Operadores de comparación (eq,ne,gt,gte,lt,lte): <pre>> db.clientes.find( { DNI: { $gt: 30000 } } )</pre></li>
            <li>Expresiones regulares: <pre>> db.clientes.find( { nombre: /M./ } )</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Campos a mostrar: <pre>{ campoAMostrar: 1, campoAOcultar: 0}</pre></li>
            <li>Recuperar sólo el DNI de los documentos en la colección “clientes”: <pre>> db.clientes.find( {} , {DNI: 1, _id: 0})</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Eliminar el 1er documento que encaje con patrón: <pre>> db.[nombre-colección].deleteOne([patrón])</pre></li>
            <li>Eliminar los documentos que encajen con patrón: <pre>> db.[nombre-colección].deleteMany([patrón])</pre></li>
            <li>Eliminar todos los documentos de una colección: <pre>> db.[nombre-colección].deleteMany( {} )</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Modificar documentos en una colección: <pre>> db.[nombre-colección].updateMany([patrón-busq], {$set: [cambios]})</pre></li>
            <li>Para los clientes cuyo DNI sea 22233, actualizar su nombre a “Nagore”: <pre>> db.clientes.updateMany({ DNI: 22233 }, {$set:{ nombre: "Nagore" } })</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Reemplazar un documento por otro: <pre>> db.[nombre-colección].replaceOne([patrón-busq], [nuevo-doc] )</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Comandos</h2>
        <ul>
            <li>Mostrar colecciones en una BD: <pre>> show collections</pre></li>
            <li>Eliminar una colección completa: <pre>> db.[nombre-colección].drop()</pre></li>
            <li>Eliminar una BD: <pre>> db.dropDatabase()</pre></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Relaciones</h2>
        <p>Un documento puede tener documentos embebidos o listados</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/embed_listado.png" alt="Crear BD" width="60%"></p>
    </section>

    <section class="slide">
        <h2>Relaciones</h2>
        <p>Normalmente:
            <ul>
                <li>Varias colecciones, cada un representa una entidad del contexto: clientes, productos, pedidos</li>
                <li>Relaciones entre los datos de diferentes entidades</li>
            </ul>
        </p>
        <p>MongoDB no proporciona una técnica concreta para definir relaciones entre colecciones: las debemos definir nosotros</p>
    </section>

    <section class="slide">
        <h2>Relaciones</h2>
        <p>Documentos embebidos</p>
        <p>Utilizar campos concretos como referencia</p>
    </section>

    <section class="slide">
        <h2>Documentos embebidos</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/embebido.png" alt="Documentos embebidos" width="20%"></p>
    </section>

    <section class="slide">
        <h2>Documentos embebidos</h2>
        <p>Adecuado para datos que no se solapan/repiten</p>
        <p>(+) Los datos se agrupan lógicamente</p>
        <p>(-) Puede generar duplicidades que debemos gestionar</p>
    </section>

    <section class="slide">
        <h2>Referencias</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/Referencias.png" alt="Referencias" width="50%"></p>
    </section>

    <section class="slide">
        <h2>Referencias</h2>
        <p>Adecuado para datos que se referencien en diferentes colecciones</p>
        <p>(+) Elimina posibles duplicidades</p>
        <p>(-) Más complejo de gestionar</p>
        <p>(-) Requiere agregaciones para obtener datos relacionados</p>
    </section>

    <section class="slide">
        <h2>Referencias</h2>
        <p>Relación entre los datos 1 a N: un cliente puede tener múltiples direcciones, una dirección pertenece sólo a 1 cliente</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/ref_1_n.png" alt="Referencias 1 N" width="60%"></p>
    </section>

    <section class="slide">
        <h2>Referencias</h2>
        <p>Relación entre los datos N a N: un cliente puede comprar múltiples productos, un producto puede ser comprado por múltiples clientes</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/ref_n_n.png" alt="Referencias 1 N" width="60%"></p>
    </section>

    <section class="slide">
        <h2>Referencias o documentos embebidos</h2>
        <p>Documentos embebidos:
            <ul>
                <li>Datos que estén fuertemente relacionados y que no estén duplicados</li>
                <li>Relaciones 1 a 1: un cliente tendrá sólo una dirección asociada</li>
                <li>Relaciones 1 a N donde no haya duplicidades</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Referencias o documentos embebidos</h2>
        <p>Referencias
            <ul>
                <li>Datos de entidades independientes pero relacionadas</li>
                <li>Relaciones 1 a N</li>
                <li>Relaciones N a N</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Relaciones</h2>
        <p>Combinacion mediante agregacion ("Join")</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/combi.png" alt="Referencias 1 N" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Agregacion mediante $lookup</h2>
        <p>Ejemplo: Crear una colección que contenga los datos de los pedidos combinados con los datos de los clientes</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/lookup.png" alt="Referencias 1 N" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>Es posible gestionar BBDD en MongoDB sin definir ningún tipo de estructura</p>
        <p>Pero en algunas situaciones puede que queramos controlar los datos de forma automática: P.e. que todos los documento de una colección “productos” tienen un campo numérico “precio”</p>
    </section>

    <section class="slide">
        <h2>Esquemas (Fuente: M. Schwarzmüller)</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-abd-01/esquemas.png" alt="Referencias 1 N" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>Se puede definir la estructura que deben cumplir los documentos de una colección</p>
        <p>Un esquema verifica cada documento insertado en una colección y genera un aviso/error si es incorrecto</p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>validationLevel: Controla cómo de estricta es la validación
            <ul>
                <li>strict (valor por defecto): Se comprueba toda inserción y modificación</li>
                <li>moderate: Las modificaciones a documentos ya existentes no se comprueban</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>validationAction: Indica qué hacer cuando un documento no cumple el esquema
            <ul>
                <li>error (valor por defecto): Se emite un error y se impide la inserción</li>
                <li>warn: Se escribe un aviso en el log de MongoDB y se permite la inserción</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p><img src="pictures-abd-01/validator.png" alt="Validator" width="80%"></p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>Mostrar el esquema de una colección: <pre>> db.getCollectionInfos({name: "marcas"})</pre></p>
        <p>Modificar el esquema de una colección: 
            <img  src="pictures-abd-01/change_validator.png" alt="Change Validator" width="80%">
        </p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p>Si validationAction es “warn”, el resultado se escribe en el log de MongoDB, por defecto en /var/log/mongodb/mongod.log</p>
    </section>

    <section class="slide">
        <h2>Esquemas</h2>
        <p><img  src="pictures-abd-01/data_types.png" alt="Validator" width="80%"></p>
    </section>

    <!-- FOOTER -->

    <footer class="badge">
        <a href="https://github.com/mikel-egana-aranguren/ShowerTemplate">Fork me on GitHub</a>
    </footer>

    <div class="progress"></div>

    <script src="../ShowerTemplate/shower/shower.js"></script>
    <!-- Copyright © 3000 Yours Truly, Famous Inc. -->

</body>
</html>
